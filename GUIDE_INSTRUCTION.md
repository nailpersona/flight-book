# Інструкція: Додавання контенту в Посібник

## Структура посібника

Посібник (Guide) складається з двох таблиць в Supabase:
- `guide_documents` — головні документи (ПВП ДАУ, КБП тощо)
- `guide_sections` — розділи та підрозділи з контентом

## Правила поведінки

### Розділ з підрозділами (accordion)
- Натискаєш → розгортаються підрозділи
- **НЕМАЄ** контенту (`content` = NULL або пустий)
- Приклад: "ІІ. Екіпаж повітряного судна"

### Підрозділ з контентом
- Натискаєш → відкривається сторінка з матеріалом
- **МАЄ** контент (`content` заповнений)
- Приклад: "1. Склад екіпажу повітряного судна"

### Розділ без підрозділів (з контентом)
- Натискаєш → одразу відкривається сторінка з матеріалом
- **МАЄ** контент
- Приклад: "I. Загальні положення"

---

## Крок 1: Додати документ

Якщо документ ще не існує:

```sql
INSERT INTO guide_documents (title, title_short, order_num)
VALUES (
  'Повне найменування документу',
  'Коротка назва',
  1
);
```

Приклад:
```sql
INSERT INTO guide_documents (title, title_short, order_num)
VALUES (
  'Правила випробувань польотами на аеродромах державної авіації України',
  'ПВП ДАУ',
  1
);
```

---

## Крок 2: Додати розділ без підрозділів (з контентом)

Приклад: "I. Загальні положення" — має тільки контент

```sql
INSERT INTO guide_sections (document_id, title, content, parent_id, order_num)
VALUES (
  1,                           -- document_id (ПВП ДАУ)
  'I. Загальні положення',     -- title
  'Текст контенту...',         -- content (повний текст!)
  NULL,                        -- parent_id (NULL = головний розділ)
  1                            -- order_num
);
```

---

## Крок 3: Додати розділ з підрозділами (accordion)

### Крок 3a: Додати головний розділ (БЕЗ контенту)

```sql
INSERT INTO guide_sections (document_id, title, parent_id, order_num)
VALUES (
  1,                           -- document_id
  'ІІ. Екіпаж повітряного судна',
  NULL,                        -- parent_id (головний розділ)
  2                            -- order_num
);
-- content залишаємо NULL - цей розділ тільки для групування підрозділів
```

### Крок 3b: Додати підрозділи (з контентом)

Спочатку дізнайся ID головного розділу:
```sql
SELECT id FROM guide_sections WHERE title = 'ІІ. Екіпаж повітряного судна';
-- Припустимо ID = 753
```

Додай підрозділи:
```sql
-- Підрозділ 1
INSERT INTO guide_sections (document_id, title, content, parent_id, order_num)
VALUES (
  1,                           -- той самий document_id
  '1. Склад екіпажу повітряного судна',
  'Текст про склад екіпажу...',
  753,                         -- parent_id = ID головного розділу
  1
);

-- Підрозділ 2
INSERT INTO guide_sections (document_id, title, content, parent_id, order_num)
VALUES (
  1,
  '2. Допуски льотного складу до польотів',
  'Текст про допуски...',
  753,                         -- той самий parent_id
  2
);
```

---

## Крок 4: Витягти текст з документу

Для документів Word (.docx) використовуй:

1. Відкрий документ у Word
2. Виділи потрібний розділ
3. Копіюй текст (Ctrl+C)
4. Встав у SQL-запит

**ВАЖЛИВО:** При вставці в SQL заміни одинарні лапки на два одинарні:
- `'` → `''`

**КРИТИЧНО:** Кінцевий текст ПОВИНЕН співпадати з оригінальним документом на 100%, крім юридичних приміток у фігурних дужках (видаляй їх). Не пропускай пункти, не обрізай речення.

**Приклад:**
```
Текст: льотний склад САД ДА
SQL:   льотний склад САД ДА
```

Або використовуй параметризований запит через Edge Function.

---

## Крок 5: Перевірка повноти контенту

Після додавання контенту ОБОВ''ЯЗКОВО перевір повноту:

1. Відкрий оригінальний документ (.docx)
2. Знайди відповідний розділ
3. Порівняй пункт за пунктом з тим, що в базі

**Що перевіряти:**
- Всі пункти присутні (немає пропущених номерів)
- Кожен пункт повністю (не обрізаний на середині речення)
- Порядок пунктів збігається з оригіналом
- Немає зайвих вставок або пропусків

**Як перевірити в Python:**
```python
from docx import Document

doc = Document(r'C:\path\to\document.docx')
# Знайти розділ і порахувати пункти
# Порівняти з content з бази даних
```

---

## Приклад: Повний цикл для "I. Загальні положення"

```sql
-- 1. Перевір, чи існує документ
SELECT * FROM guide_documents WHERE title_short = 'ПВП ДАУ';

-- 2. Додай розділ з контентом
INSERT INTO guide_sections (document_id, title, content, order_num)
VALUES (
  1,
  'I. Загальні положення',
  '**1.** Ці Правила визначають порядок організації та проведення польотів державної авіації (далі - ДА)...',
  1
);
```

---

## Приклад: Розділ з підрозділами

```sql
-- 1. Додай головний розділ
INSERT INTO guide_sections (document_id, title, parent_id, order_num)
VALUES (1, 'ІІ. Екіпаж повітряного судна', NULL, 2);

-- 2. Дізнайся ID
SELECT id FROM guide_sections WHERE title = 'ІІ. Екіпаж повітряного судна';
-- Припустимо: 753

-- 3. Додай підрозділи
INSERT INTO guide_sections (document_id, title, content, parent_id, order_num)
VALUES
  (1, '1. Склад екіпажу повітряного судна', 'Текст...', 753, 1),
  (1, '2. Допуски льотного складу до польотів', 'Текст...', 753, 2),
  (1, '3. Обов''язки командира екіпажу', 'Текст...', 753, 3);
```

---

## Перевірка

```sql
-- Перевір структуру
SELECT
  s.id,
  s.title,
  s.parent_id,
  s.order_num,
  CASE WHEN s.content IS NULL THEN 'accordion' ELSE 'content' END as type
FROM guide_sections s
WHERE s.document_id = 1
ORDER BY s.order_num;
```

---

## Форматування контенту

Для markdown-форматування в контенті:
- **Жирний**: `**текст**`
- *Курсив*: `*текст*`
- Новий абзац: порожній рядок

Приклад:
```sql
'**1.** Це заголовок

Це абзац з текстом.

**2.** Це інший заголовок

Продовження тексту...'
```

---

## SQL через Supabase Dashboard

1. Відкрий https://supabase.com/dashboard
2. Вибери проект `klqxadvtvxvizgdjmegx`
3. SQL Editor → New query
4. Встав SQL-код
5. Run

---

## Нюанси

1. **order_num** — важливий! Визначає порядок відображення
2. **parent_id**:
   - `NULL` = головний розділ (верхній рівень)
   - число = підрозділ (всередині іншого розділу)
3. **content**:
   - Є контент → натискання відкриває сторінку з матеріалом
   - Немає контенту → натискання розгортає підрозділи
4. **document_id** — один і той самий для всіх розділів одного документа
5. **Повнота контенту** — завжди порівнюй з оригінальним документом. Контент в базі має бути 100% ідентичним оригіналу, включаючи всі підпункти, абзаци та примітки (крім юридичних приміток у фігурних дужках)
